<div class="container mt-5">
  <h2>Datos del Paciente</h2>
  <form (ngSubmit)="guardar(pacienteForm)" #pacienteForm="ngForm">
    <div class="mb-3">
      <label for="_id">DNI / N° Orden *</label>
      <input 
        type="text" 
        class="form-control" 
        id="_id"
        name="_id" 
        [(ngModel)]="_id" 
        required 
        [class.is-invalid]="submitted && pacienteForm.controls['_id']?.invalid"
        placeholder="Ej: 12345678"
        maxlength="8"
      />
      <div *ngIf="submitted && pacienteForm.controls['_id']?.invalid" class="invalid-feedback">
        <div *ngIf="pacienteForm.controls['_id']?.errors?.['required']">El DNI es obligatorio</div>
        <div *ngIf="!_id || !validarDNI(_id)">El DNI debe tener entre 7 y 8 dígitos</div>
      </div>
    </div>
    
    <div class="mb-3">
      <label for="fecha">Fecha *</label>
      <input 
        type="text" 
        class="form-control" 
        id="fecha"
        name="fecha" 
        [(ngModel)]="fecha" 
        required 
        placeholder="dd/mm/yyyy"
        pattern="^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/\d{4}$"
        [class.is-invalid]="submitted && (!fecha || !esFechaDdMmYyyy(fecha))"
      />
      <div *ngIf="submitted && (!fecha || !esFechaDdMmYyyy(fecha))" class="invalid-feedback">
        Ingrese una fecha válida con formato dd/mm/yyyy
      </div>
    </div>
    
    <div class="mb-3">
      <label for="paciente">Nombre y Apellido *</label>
      <input 
        type="text" 
        class="form-control" 
        id="paciente"
        name="paciente" 
        [(ngModel)]="paciente" 
        required 
        [class.is-invalid]="submitted && pacienteForm.controls['paciente']?.invalid"
        placeholder="Ej: Juan Pérez"
      />
      <div *ngIf="submitted && pacienteForm.controls['paciente']?.invalid" class="invalid-feedback">
        El nombre es obligatorio
      </div>
    </div>
    
    <div class="mb-3">
      <label for="fechaNacimiento">Fecha de Nacimiento *</label>
      <input 
        type="text" 
        class="form-control" 
        id="fechaNacimiento"
        name="fechaNacimiento" 
        [(ngModel)]="fechaNacimiento" 
        required 
        placeholder="dd/mm/yyyy"
        pattern="^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/\d{4}$"
        [class.is-invalid]="submitted && (!fechaNacimiento || !esFechaDdMmYyyy(fechaNacimiento))"
      />
      <div *ngIf="submitted && (!fechaNacimiento || !esFechaDdMmYyyy(fechaNacimiento))" class="invalid-feedback">
        Ingrese una fecha de nacimiento válida con formato dd/mm/yyyy
      </div>
    </div>
    
    <div class="mb-3">
      <label for="celular">Celular</label>
      <input 
        type="tel" 
        class="form-control" 
        id="celular"
        name="celular" 
        [(ngModel)]="celular" 
        [class.is-invalid]="submitted && celular && !validarTelefono(celular)"
        placeholder="Ej: +54 9 11 1234-5678"
      />
      <div *ngIf="submitted && celular && !validarTelefono(celular)" class="invalid-feedback">
        El formato del teléfono no es válido
      </div>
    </div>
    
    <div class="mb-3">
      <label for="email">Email</label>
      <input 
        type="email" 
        class="form-control" 
        id="email"
        name="email" 
        [(ngModel)]="email" 
        [class.is-invalid]="submitted && email && !validarEmail(email)"
        placeholder="Ej: juan.perez@email.com"
      />
      <div *ngIf="submitted && email && !validarEmail(email)" class="invalid-feedback">
        El formato del email no es válido
      </div>
    </div>
    
    <div class="mb-3">
      <label for="optica">Óptica</label>
      <input 
        type="text" 
        class="form-control" 
        id="optica"
        name="optica" 
        [(ngModel)]="optica" 
        placeholder="Ej: La Dolce Vista"
      />
    </div>
    
    <div class="mb-3">
      <label for="doctor">Doctor</label>
      <input 
        type="text" 
        class="form-control" 
        id="doctor"
        name="doctor" 
        [(ngModel)]="doctor" 
        placeholder="Ej: Dr. María López"
      />
    </div>
    <h3>Prescripción</h3>
    <div class="row">
      <div class="col">
        <h4>OD</h4>
        <div class="mb-2">
          <label>Esf</label>
          <input type="text" class="form-control" name="prescripcionOD_Esf" [(ngModel)]="prescripcion.OD.Esf" />
        </div>
        <div class="mb-2">
          <label>Cil</label>
          <input type="text" class="form-control" name="prescripcionOD_Cil" [(ngModel)]="prescripcion.OD.Cil" />
        </div>
        <div class="mb-2">
          <label>Eje</label>
          <input type="text" class="form-control" name="prescripcionOD_Eje" [(ngModel)]="prescripcion.OD.Eje" />
        </div>
        <div class="mb-2">
          <label>Ad</label>
          <input type="text" class="form-control" name="prescripcionOD_Ad" [(ngModel)]="prescripcion.OD.Ad" />
        </div>
        <div class="mb-2">
          <label>DNP</label>
          <input type="text" class="form-control" name="prescripcionOD_DNP" [(ngModel)]="prescripcion.OD.DNP" />
        </div>
        <div class="mb-2">
          <label>Alt</label>
          <input type="text" class="form-control" name="prescripcionOD_Alt" [(ngModel)]="prescripcion.OD.Alt" />
        </div>
      </div>
      <div class="col">
        <h4>OI</h4>
        <div class="mb-2">
          <label>Esf</label>
          <input type="text" class="form-control" name="prescripcionOI_Esf" [(ngModel)]="prescripcion.OI.Esf" />
        </div>
        <div class="mb-2">
          <label>Cil</label>
          <input type="text" class="form-control" name="prescripcionOI_Cil" [(ngModel)]="prescripcion.OI.Cil" />
        </div>
        <div class="mb-2">
          <label>Eje</label>
          <input type="text" class="form-control" name="prescripcionOI_Eje" [(ngModel)]="prescripcion.OI.Eje" />
        </div>
        <div class="mb-2">
          <label>Ad</label>
          <input type="text" class="form-control" name="prescripcionOI_Ad" [(ngModel)]="prescripcion.OI.Ad" />
        </div>
        <div class="mb-2">
          <label>DNP</label>
          <input type="text" class="form-control" name="prescripcionOI_DNP" [(ngModel)]="prescripcion.OI.DNP" />
        </div>
        <div class="mb-2">
          <label>Alt</label>
          <input type="text" class="form-control" name="prescripcionOI_Alt" [(ngModel)]="prescripcion.OI.Alt" />
        </div>
      </div>
    </div>
    <div class="mb-3 mt-3">
      <label>Comentario</label>
      <textarea class="form-control" name="comentario" [(ngModel)]="comentario"></textarea>
    </div>
    
    
    <!-- Mensajes de estado -->
    <div *ngIf="mensaje" class="alert" [ngClass]="{'alert-success': !loading, 'alert-info': loading}" role="alert">
      {{ mensaje }}
    </div>
    
    <button type="submit" class="btn btn-primary" [disabled]="loading">
      <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status"></span>
      {{ loading ? 'Guardando...' : 'Guardar' }}
    </button>
  </form>
</div>
